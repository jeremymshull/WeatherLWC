<template>
  <lightning-card title="Weather Lookup" icon-name="action:web_link">
    <div class="slds-p-around_medium">
      <!-- Input + Actions -->
      <div class="slds-grid slds-wrap slds-gutters slds-var-m-bottom_small">
        <div class="slds-col slds-size_1-of-1 slds-large-size_2-of-3">
          <lightning-input
            label="Enter City Name"
            value={city}
            onchange={handleCityChange}
            onkeyup={handleKeyUp}
            placeholder="e.g., San Francisco, Chicago, Miami">
          </lightning-input>
          <template if:true={sourcedFromRecordNote}>
            <div class="slds-text-color_weak slds-m-top_x-small">
              {sourcedFromRecordNote}
            </div>
          </template>
        </div>
        <div class="slds-col slds-size_1-of-1 slds-large-size_1-of-3 slds-align_absolute-center slds-m-top_small slds-large-m-top_none">
          <lightning-button
            label="Get Weather"
            variant="brand"
            class="slds-m-right_x-small"
            onclick={fetchWeather}
            disabled={isLoading}>
          </lightning-button>
          <lightning-button
            label="Clear"
            variant="neutral"
            onclick={handleClear}
            disabled={isLoading}>
          </lightning-button>
        </div>
      </div>

      <!-- Error State -->
      <template if:true={error}>
        <div class="slds-notify slds-notify_alert slds-theme_error slds-m-bottom_small" role="alert">
          <span class="slds-assistive-text">Error</span>
          <span class="slds-icon_container slds-icon-utility-error slds-m-right_x-small" title="error">
            <lightning-icon icon-name="utility:error" size="x-small" alternative-text="Error"></lightning-icon>
          </span>
          <h2 class="slds-truncate" title={error}>{error}</h2>
        </div>
      </template>

      <!-- Results -->
      <div aria-live="polite" class="results-region">
        <template if:true={hasResults}>
          <!-- Header summary -->
          <div class="slds-grid slds-wrap slds-m-bottom_small slds-var-p-around_small card-header">
            <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3">
              <div class="slds-text-heading_medium slds-truncate slds-grid slds-grid_vertical-align-center" title={weather.name}>
                <lightning-icon icon-name="action:map" size="x-small" class="slds-m-right_x-small" alternative-text="City" title="City"></lightning-icon>
                {weather.name}
              </div>
              <div class="slds-m-top_x-small">
                <lightning-badge label={description}></lightning-badge>
              </div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3 slds-text-align_right">
              <div class="temperature-display">
                {weather.main.temp} °F
              </div>
              <div class="slds-text-color_weak slds-text-body_small">Feels like {weather.main.feels_like} °F</div>
            </div>
          </div>

          <!-- Metrics grid -->
          <div class="slds-grid slds-wrap slds-gutters metrics-grid">
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
              <div class="metric-row">
                <lightning-icon icon-name="action:new_custom97" size="small" class="slds-m-right_small" alternative-text="Temperature"></lightning-icon>
                <div>
                  <div class="slds-text-title">Temperature</div>
                  <div class="slds-text-heading_small">{weather.main.temp} °F</div>
                </div>
              </div>
              <div class="metric-row">
                <lightning-icon icon-name="action:description" size="small" class="slds-m-right_small" alternative-text="Description"></lightning-icon>
                <div>
                  <div class="slds-text-title">Conditions</div>
                  <div class="slds-text-heading_small slds-truncate" title={description}>{description}</div>
                </div>
              </div>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2">
              <div class="metric-row">
                <lightning-icon icon-name="action:new_custom3" size="small" class="slds-m-right_small" alternative-text="Humidity"></lightning-icon>
                <div>
                  <div class="slds-text-title">Humidity</div>
                  <div class="slds-text-heading_small">{weather.main.humidity}%</div>
                </div>
              </div>
              <div class="metric-row">
                <lightning-icon icon-name="action:new_custom2" size="small" class="slds-m-right_small" alternative-text="Wind"></lightning-icon>
                <div>
                  <div class="slds-text-title">Wind Speed</div>
                  <div class="slds-text-heading_small">{weather.wind.speed} mph</div>
                </div>
              </div>
            </div>
          </div>
        </template>

        <!-- Loading State -->
        <template if:true={isLoading}>
          <div class="slds-is-relative slds-m-top_medium slds-m-bottom_medium">
            <lightning-spinner alternative-text="Loading weather" size="small"></lightning-spinner>
          </div>
        </template>
      </div>
    </div>
  </lightning-card>
</template>
